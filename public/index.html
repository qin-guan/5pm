<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite App</title>
  </head>
  <body>
    <div id="app" v-scope @vue:mounted="mounted" @vue:unmounted="unmounted">
      <h1>{{ is5pm ? "Yes" : "No" }}</h1>
      <span v-if="!is5pm">
        {{ relative5pm }}
        <br />
        Now: {{ now }}
      </span>
    </div>
    <script type="module">
      import { formatDistance, format } from 'https://cdn.skypack.dev/date-fns';
      import { createApp } from 'https://unpkg.com/petite-vue?module';

      const HOUR = 17;

      const pm = () => {
        const d = new Date();
        d.setHours(HOUR);
        return d
      }

      const f = (d) => format(d, 'mm:HH:ss');

      createApp({
        relative5pm: `${formatDistance(pm(), new Date())} till 5pm`,
        is5pm: new Date().getHours() === HOUR,
        now: f(new Date()),
        mounted() {
          const update = () => (this.now = f(new Date()));
          setInterval(update, 1000);
          
          const source = new EventSource('/e');

          source.addEventListener('message', message => {
            console.log('Got', message);
          });
        },
        unmounted() {
          clearInterval(update);
        },
      }).mount();
    </script>
  </body>
</html>
